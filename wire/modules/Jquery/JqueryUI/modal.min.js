var pwModalWindows=[];function pwModalWindowSettings(b){var d=config.modals[b];if(typeof d=="undefined"){d=config.modals.medium}d=d.split(",");var a={modal:true,draggable:false,resizable:true,hide:250,show:100,hideOverflow:true,closeOnEscape:false};if(d.length>=4){for(var f=4;f<d.length;f++){var e=d[f];if(e.indexOf("=")<1){continue}e=e.split("=");var c=jQuery.trim(e[0]);e=jQuery.trim(e[1].toLowerCase());if(typeof a[c]=="undefined"){continue}if(e=="true"||e=="1"){e=true}else{if(e=="false"||e=="0"){e=false}else{e=parseInt(e)}}a[c]=e}}return{modal:a.modal,draggable:a.draggable,resizable:a.resizable,position:[parseInt(d[0]),parseInt(d[1])],width:jQuery(window).width()-parseInt(d[2]),height:jQuery(window).height()-parseInt(d[3]),hide:a.hide,show:a.show,closeOnEscape:a.closeOnEscape,create:function(g,h){if(a.hideOverflow){parent.jQuery("body").css("overflow","hidden")}var i=jQuery(this).dialog("widget");jQuery(".ui-dialog-titlebar-close",i).css("padding-top",0).prepend("<i class='fa fa-times'></i>").find(".ui-icon").remove()},beforeClose:function(g,h){if(a.hideOverflow){parent.jQuery("body").css("overflow","")}}}}function pwModalWindow(c,j,i){for(var e=0;e<=pwModalWindows.length;e++){var h=pwModalWindows[e];if(h==null){continue}if(h.dialog("isOpen")){continue}h.dialog("destroy").remove();pwModalWindows[e]=null}if(c.indexOf("modal=")>0){var b=c}else{var b=c+(c.indexOf("?")>-1?"&":"?")+"modal=1"}var h=jQuery('<iframe class="pw-modal-window" frameborder="0" src="'+b+'"></iframe>');h.attr("id","pw-modal-window-"+(pwModalWindows.length+1));if(typeof i=="undefined"||i.length==0){var i="large"}var f=pwModalWindowSettings(i);if(f==null){alert("Unknown modal setting: "+i);return h}if(typeof j!="undefined"){jQuery.extend(f,j)}h.on("dialogopen",function(k,l){jQuery(document).trigger("pw-modal-opened",{event:k,ui:l})});h.on("dialogclose",function(k,l){jQuery(document).trigger("pw-modal-closed",{event:k,ui:l})});h.dialog(f);h.data("settings",f);h.load(function(){if(typeof f.title=="undefined"||!f.title){h.dialog("option","title",h.contents().find("title").text())}h.contents().find("form").css("-webkit-backface-visibility","hidden")});var d=0;var g=0;function a(){var n=jQuery(window).width();var l=jQuery(window).height();if(n==d&&l==g){return}var m=i;if(n<=960&&i!="full"&&i!="large"){m="large"}if(n<=700&&i!="full"){m="full"}var o=pwModalWindowSettings(m);var p=h.closest(".ui-dialog");if(p.length>0){var k=p.find(".ui-dialog-buttonpane").outerHeight()+p.find(".ui-dialog-titlebar").outerHeight();o.height-=k}h.dialog("option","width",o.width);h.dialog("option","height",o.height);h.dialog("option","position",o.position);h.width(o.width).height(o.height);d=n;g=l}a();jQuery(window).resize(a);h.refresh=function(){d=0;g=0;a()};h.setButtons=function(k){h.dialog("option","buttons",k);h.refresh()};h.setTitle=function(k){h.dialog("option","title",k)};return h}jQuery(document).ready(function(a){a.widget("ui.dialog",a.extend({},a.ui.dialog.prototype,{_title:function(b){if(!this.options.title){b.html("&#160;")}else{b.html(this.options.title)}}}));a(document).on("click","a.pw-modal, button.pw-modal",function(){var d=a(this);var b=d.attr("data-autoclose");var k=b!=null;var i=k&&b.length>1?b:"";var h=d.attr("data-close");var j=false;var e="medium";if(d.hasClass("pw-modal-large")){e="large"}else{if(d.hasClass("pw-modal-small")){e="small"}else{if(d.hasClass("pw-modal-full")){e="full"}}}var f={title:d.attr("title"),close:function(o,p){d.trigger("modal-close",{event:o,ui:p});d.trigger("pw-modal-closed",{event:o,ui:p});a(document).trigger("pw-modal-closed",{event:o,ui:p});g.remove()}};var n=d.attr("data-buttons");if(h==null){h=""}h+=(h.length>0?", ":"")+".pw-modal-cancel";var g=a("<i class='fa fa-spin fa-spinner fa-2x ui-priority-secondary'></i>").css({position:"absolute",top:(parseInt(a(window).height()/2)-80)+"px",left:(parseInt(a(window).width()/2)-20)+"px","z-index":9999}).hide();if(d.is("button")){var l=d.closest("a");var c=l.length?l.attr("href"):d.attr("data-href");if(!c){c=d.find("a").attr("href")}if(!c){alert("Unable to find href attribute for: "+d.text());return}}else{var c=d.attr("href")}var m=pwModalWindow(c,f,e);a("body").append(g.fadeIn("fast"));m.load(function(){var p=[];var r=m.contents();var s=0;g.fadeOut("fast",function(){g.remove()});if(j){if(r.find(".NoticeError, .NoticeWarning, .ui-state-error").length==0){if(typeof Notifications!="undefined"){var o=[];r.find(".NoticeMessage").each(function(){o[o.length]=a(this).text()});if(o.length>0){setTimeout(function(){for(var t=0;t<o.length;t++){Notifications.message(o[t])}},500)}}m.dialog("close");return}}var q=r.find("body");q.hide();if(n){r.find(n).each(function(){var v=a(this);v.find(".ui-button-text").removeClass("ui-button-text");var w=v.html();var u=false;for(var t=0;t<p.length;t++){if(p[t].text==w||w.length<1){u=true}}if(!u){p[s]={html:w,"class":(v.is(".ui-priority-secondary")?"ui-priority-secondary":""),click:function(x){a(x.currentTarget).fadeOut("fast");v.click();if(h.length>0&&v.is(h)){m.dialog("close")}if(k){a("body").append(g.fadeIn());if(i.length>1){j=v.is(i)}else{j=true}}}};s++}if(!v.hasClass("pw-modal-button-visible")){v.hide()}})}if(p.length>0){m.setButtons(p)}q.fadeIn("fast",function(){q.show()})});return false})});