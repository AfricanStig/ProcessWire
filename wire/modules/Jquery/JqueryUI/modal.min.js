var pwModalWindows=[];function pwModalWindowSettings(b){var d=config.modals[b];if(typeof d=="undefined"){d=config.modals.medium}d=d.split(",");var a={modal:true,draggable:false,resizable:true,hide:250,show:100,hideOverflow:true,closeOnEscape:false};if(d.length>=4){for(var f=4;f<d.length;f++){var e=d[f];if(e.indexOf("=")<1){continue}e=e.split("=");var c=jQuery.trim(e[0]);e=jQuery.trim(e[1].toLowerCase());if(typeof a[c]=="undefined"){continue}if(e=="true"||e=="1"){e=true}else{if(e=="false"||e=="0"){e=false}else{e=parseInt(e)}}a[c]=e}}return{modal:a.modal,draggable:a.draggable,resizable:a.resizable,position:[parseInt(d[0]),parseInt(d[1])],width:$(window).width()-parseInt(d[2]),height:$(window).height()-parseInt(d[3]),hide:a.hide,show:a.show,closeOnEscape:a.closeOnEscape,create:function(g,h){if(a.hideOverflow){parent.jQuery("body").css("overflow","hidden")}},beforeClose:function(g,h){if(a.hideOverflow){parent.jQuery("body").css("overflow","auto")}}}}function pwModalWindow(c,j,i){for(var e=0;e<=pwModalWindows.length;e++){var h=pwModalWindows[e];if(h==null){continue}if(h.dialog("isOpen")){continue}h.dialog("destroy").remove();pwModalWindows[e]=null}var b=c+(c.indexOf("?")>-1?"&":"?")+"modal=1";var h=$('<iframe class="pw-modal-window" frameborder="0" src="'+b+'"></iframe>');h.attr("id","pw-modal-window-"+(pwModalWindows.length+1));if(typeof i=="undefined"||i.length==0){var i="large"}var f=pwModalWindowSettings(i);if(f==null){alert("Unknown modal setting: "+i);return h}if(typeof j!="undefined"){$.extend(f,j)}h.on("dialogopen",function(k,l){$(document).trigger("pw-modal-opened",{event:k,ui:l})});h.on("dialogclose",function(k,l){$(document).trigger("pw-modal-closed",{event:k,ui:l})});h.dialog(f);h.data("settings",f);h.load(function(){if(typeof f.title=="undefined"||!f.title){h.dialog("option","title",h.contents().find("title").text())}h.contents().find("form").css("-webkit-backface-visibility","hidden")});var d=0;var g=0;function a(){var n=$(window).width();var l=$(window).height();if(n==d&&l==g){return}var m=i;if(n<=960&&i!="full"&&i!="large"){m="large"}if(n<=700&&i!="full"){m="full"}var o=pwModalWindowSettings(m);var p=h.closest(".ui-dialog");if(p.length>0){var k=p.find(".ui-dialog-buttonpane").outerHeight()+p.find(".ui-dialog-titlebar").outerHeight();o.height-=k}h.dialog("option","width",o.width);h.dialog("option","height",o.height);h.dialog("option","position",o.position);h.width(o.width).height(o.height);d=n;g=l}a();$(window).resize(a);h.refresh=function(){d=0;g=0;a()};h.setButtons=function(k){h.dialog("option","buttons",k);h.refresh()};h.setTitle=function(k){h.dialog("option","title",k)};return h}$(document).ready(function(){$.widget("ui.dialog",$.extend({},$.ui.dialog.prototype,{_title:function(a){if(!this.options.title){a.html("&#160;")}else{a.html(this.options.title)}}}));$(document).on("click","a.pw-modal",function(){var b=$(this);var a=b.attr("data-autoclose");var i=a!=null;var g=i&&a.length>1?a:"";var f=b.attr("data-close");var h=false;var c="medium";if(b.hasClass("pw-modal-large")){c="large"}else{if(b.hasClass("pw-modal-small")){c="small"}else{if(b.hasClass("pw-modal-full")){c="full"}}}var d={title:b.attr("title"),close:function(l,m){b.trigger("modal-close",{event:l,ui:m});b.trigger("pw-modal-closed",{event:l,ui:m});$(document).trigger("pw-modal-closed",{event:l,ui:m});e.remove()}};var k=b.attr("data-buttons");if(f==null){f=""}f+=(f.length>0?", ":"")+".pw-modal-cancel";var e=$("<i class='fa fa-spin fa-spinner fa-2x ui-priority-secondary'></i>").css({position:"absolute",top:(parseInt($(window).height()/2)-80)+"px",left:(parseInt($(window).width()/2)-20)+"px","z-index":9999}).hide();var j=pwModalWindow(b.attr("href"),d,c);$("body").append(e.fadeIn("fast"));j.load(function(){var m=[];var p=j.contents();var q=0;e.fadeOut("fast",function(){e.remove()});if(h){if(p.find(".NoticeError, .NoticeWarning, .ui-state-error").length==0){if(typeof Notifications!="undefined"){var l=[];p.find(".NoticeMessage").each(function(){l[l.length]=$(this).text()});if(l.length>0){setTimeout(function(){for(var n=0;n<l.length;n++){Notifications.message(l[n])}},500)}}j.dialog("close");return}}var o=p.find("body");o.hide();if(k){p.find(k).each(function(){var s=$(this);s.find(".ui-button-text").removeClass("ui-button-text");var t=s.html();var r=false;for(var n=0;n<m.length;n++){if(m[n].text==t||t.length<1){r=true}}if(!r){m[q]={html:t,"class":(s.is(".ui-priority-secondary")?"ui-priority-secondary":""),click:function(u){$(u.currentTarget).fadeOut("fast");s.click();if(f.length>0&&s.is(f)){j.dialog("close")}if(i){$("body").append(e.fadeIn());if(g.length>1){h=s.is(g)}else{h=true}}}};q++}s.hide()})}if(m.length>0){j.setButtons(m)}o.fadeIn("fast",function(){o.show()})});return false})});