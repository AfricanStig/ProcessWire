(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(e){function c(l,f){this.cm=l;this.options=this.buildOptions(f);this.widget=null;this.tick=this.debounce=0;this.startPos=this.cm.getCursor();this.startLen=this.cm.getLine(this.startPos.line).length;var m=this;l.on("cursorActivity",this.activityFunc=function(){m.cursorActivity()})}function j(m,l){function r(f,t){var s;s="string"!=typeof t?function(u){return t(u,l)}:p.hasOwnProperty(t)?p[t]:t;o[f]=s}var p={Up:function(){l.moveFocus(-1)},Down:function(){l.moveFocus(1)},PageUp:function(){l.moveFocus(-l.menuSize()+1,!0)},PageDown:function(){l.moveFocus(l.menuSize()-1,!0)},Home:function(){l.setFocus(0)},End:function(){l.setFocus(l.length-1)},Enter:l.pick,Tab:l.pick,Esc:l.close},q=m.options.customKeys,o=q?{}:p;if(q){for(var n in q){q.hasOwnProperty(n)&&r(n,q[n])}}if(q=m.options.extraKeys){for(n in q){q.hasOwnProperty(n)&&r(n,q[n])}}return o}function k(l,f){for(;f&&f!=l;){if("LI"===f.nodeName.toUpperCase()&&f.parentNode==l){return f}f=f.parentNode}}function d(F,E){this.completion=F;this.data=E;this.picked=!1;var D=this,B=F.cm,C=this.hints=document.createElement("ul");C.className="CodeMirror-hints";this.selectedHint=E.selectedHint||0;for(var w=E.list,A=0;A<w.length;++A){var x=C.appendChild(document.createElement("li")),z=w[A],y=i+(A!=this.selectedHint?"":" "+a);null!=z.className&&(y=z.className+" "+y);x.className=y;z.render?z.render(x,E,z):x.appendChild(document.createTextNode(z.displayText||("string"==typeof z?z:z.text)));x.hintId=A}var A=B.cursorCoords(F.options.alignWithWord?E.from:null),s=A.left,q=A.bottom,v=!0;C.style.left=s+"px";C.style.top=q+"px";x=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);y=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(F.options.container||document.body).appendChild(C);z=C.getBoundingClientRect();if(0<z.bottom-y){var f=z.bottom-z.top;0<A.top-(A.bottom-z.top)-f?(C.style.top=(q=A.top-f)+"px",v=!1):f>y&&(C.style.height=y-5+"px",C.style.top=(q=A.bottom-z.top)+"px",y=B.getCursor(),E.from.ch!=y.ch&&(A=B.cursorCoords(y),C.style.left=(s=A.left)+"px",z=C.getBoundingClientRect()))}y=z.right-x;0<y&&(z.right-z.left>x&&(C.style.width=x-5+"px",y-=z.right-z.left-x),C.style.left=(s=A.left-y)+"px");B.addKeyMap(this.keyMap=j(F,{moveFocus:function(m,l){D.changeActive(D.selectedHint+m,l)},setFocus:function(l){D.changeActive(l)},menuSize:function(){return D.screenAmount()},length:w.length,close:function(){F.close()},pick:function(){D.pick()},data:E}));if(F.options.closeOnUnfocus){var u;B.on("blur",this.onBlur=function(){u=setTimeout(function(){F.close()},100)});B.on("focus",this.onFocus=function(){clearTimeout(u)})}var t=B.getScrollInfo();B.on("scroll",this.onScroll=function(){var o=B.getScrollInfo(),l=B.getWrapperElement().getBoundingClientRect(),n=q+t.top-o.top,m=n-(window.pageYOffset||(document.documentElement||document.body).scrollTop);v||(m=m+C.offsetHeight);if(m<=l.top||m>=l.bottom){return F.close()}C.style.top=n+"px";C.style.left=s+t.left-o.left+"px"});e.on(C,"dblclick",function(l){if((l=k(C,l.target||l.srcElement))&&l.hintId!=null){D.changeActive(l.hintId);D.pick()}});e.on(C,"click",function(l){if((l=k(C,l.target||l.srcElement))&&l.hintId!=null){D.changeActive(l.hintId);F.options.completeOnSingleClick&&D.pick()}});e.on(C,"mousedown",function(){setTimeout(function(){B.focus()},20)});e.signal(E,"select",w[0],C.firstChild);return !0}var i="CodeMirror-hint",a="CodeMirror-hint-active";e.showHint=function(l,f,n){if(!f){return l.showHint(n)}n&&n.async&&(f.async=!0);f={hint:f};if(n){for(var m in n){f[m]=n[m]}}return l.showHint(f)};e.defineExtension("showHint",function(f){1<this.listSelections().length||this.somethingSelected()||(this.state.completionActive&&this.state.completionActive.close(),f=this.state.completionActive=new c(this,f),f.options.hint&&(e.signal(this,"startCompletion",this),f.update()))});var h=window.requestAnimationFrame||function(f){return setTimeout(f,1000/60)},g=window.cancelAnimationFrame||clearTimeout;c.prototype={close:function(){this.active()&&(this.tick=this.cm.state.completionActive=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.widget.close(),e.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(l,f){var m=l.list[f];m.hint?m.hint(this.cm,l,m):this.cm.replaceRange("string"==typeof m?m:m.text,m.from||l.from,m.to||l.to,"complete");e.signal(l,"pick",m);this.close()},showHints:function(f){if(!f||!f.list.length||!this.active()){return this.close()}this.options.completeSingle&&1==f.list.length?this.pick(f,0):this.showWidget(f)},cursorActivity:function(){this.debounce&&(g(this.debounce),this.debounce=0);var l=this.cm.getCursor(),f=this.cm.getLine(l.line);if(l.line!=this.startPos.line||f.length-l.ch!=this.startLen-this.startPos.ch||l.ch<this.startPos.ch||this.cm.somethingSelected()||l.ch&&this.options.closeCharacters.test(f.charAt(l.ch-1))){this.close()}else{var m=this;this.debounce=h(function(){m.update()});this.widget&&this.widget.disable()}},update:function(){if(null!=this.tick){if(this.data&&e.signal(this.data,"update"),this.options.hint.async){var l=++this.tick,f=this;this.options.hint(this.cm,function(m){f.tick==l&&f.finishUpdate(m)},this.options)}else{this.finishUpdate(this.options.hint(this.cm,this.options),l)}}},finishUpdate:function(l){this.data=l;var f=this.widget&&this.widget.picked;this.widget&&this.widget.close();l&&l.list.length&&(f&&1==l.list.length?this.pick(l,0):this.widget=new d(this,l))},showWidget:function(f){this.data=f;this.widget=new d(this,f);e.signal(f,"shown")},buildOptions:function(l){var f=this.cm.options.hintOptions,n={},m;for(m in b){n[m]=b[m]}if(f){for(m in f){void 0!==f[m]&&(n[m]=f[m])}}if(l){for(m in l){void 0!==l[m]&&(n[m]=l[m])}}return n}};d.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var f=this.completion.cm;this.completion.options.closeOnUnfocus&&(f.off("blur",this.onBlur),f.off("focus",this.onFocus));f.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var f=this;this.keyMap={Enter:function(){f.picked=!0}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(l,f){l>=this.data.list.length?l=f?this.data.list.length-1:0:0>l&&(l=f?0:this.data.list.length-1);if(this.selectedHint!=l){var m=this.hints.childNodes[this.selectedHint];m.className=m.className.replace(" "+a,"");m=this.hints.childNodes[this.selectedHint=l];m.className+=" "+a;m.offsetTop<this.hints.scrollTop?this.hints.scrollTop=m.offsetTop-3:m.offsetTop+m.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=m.offsetTop+m.offsetHeight-this.hints.clientHeight+3);e.signal(this.data,"select",this.data.list[this.selectedHint],m)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};e.registerHelper("hint","auto",function(l,f){var o=l.getHelpers(l.getCursor(),"hint");if(o.length){for(var m=0;m<o.length;m++){var n=o[m](l,f);if(n&&n.list.length){return n}}}else{if(o=l.getHelper(l.getCursor(),"hintWords")){if(o){return e.hint.fromList(l,{words:o})}}else{if(e.hint.anyword){return e.hint.anyword(l,f)}}}});e.registerHelper("hint","fromList",function(l,f){for(var q=l.getCursor(),o=l.getTokenAt(q),p=[],m=0;m<f.words.length;m++){var n=f.words[m];n.slice(0,o.string.length)==o.string&&p.push(n)}if(p.length){return{list:p,from:e.Pos(q.line,o.start),to:e.Pos(q.line,o.end)}}});e.commands.autocomplete=e.showHint;var b={hint:e.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!1,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)});