function InputfieldImage(f){var p=null;var c={file:"",item:null,edit:null};var u={type:"image",closeOnContentClick:true,closeBtnInside:true};function a(){var B=window.File&&window.FileList&&window.FileReader;var A=f(".InputfieldAllowAjaxUpload").length>0;var C=f("#PageIDIndicator").length>0;return(B&&(C||A))}function i(C,A,B){A||(A=250);var D,E;return function(){var H=B||this;var G=+new Date(),F=arguments;if(D&&G<D+A){clearTimeout(E);E=setTimeout(function(){D=G;C.apply(H,F)},A)}else{D=G;C.apply(H,F)}}}function j(B,A){return !A}function x(A){if(A.hasClass("ui-sortable")){A.sortable("destroy");A.children("li").each(function(C){var B=f(this).find("input.InputfieldFileSort");B.val(C)})}A.sortable({items:"> .gridImage",start:function(C,B){B.placeholder.append(f("<div/>").css({display:"block",height:A.data("gridsize")+"px",width:A.data("gridsize")+"px"}));timer=window.setTimeout(function(){e(A,null)},100);A.addClass("InputfieldImageSorting")},stop:function(C,B){$this=f(this);if(timer!==null){B.item.find(".InputfieldImageEdit__edit").click();clearTimeout(timer)}$this.children("li").each(function(D){f(this).find(".InputfieldFileSort").val(D)});B.item.find(".InputfieldFileSort").change();A.removeClass("InputfieldImageSorting")},cancel:".InputfieldImageEdit"})}function d(B){var A=u;A.callbacks={elementParse:function(C){C.src=f(C.el).attr("data-original")}};A.gallery={enabled:true};B.find("img").magnificPopup(A)}function r(B){var A=u;A.callbacks={elementParse:function(C){C.src=f(C.el).attr("src")}};A.gallery={enabled:false};B.find("img").magnificPopup(A)}function k(A){return A.find(".InputfieldImageEdit--active")}function o(A){return f("#"+A.find(".InputfieldImageEdit__edit").attr("data-current"))}function t(B){var A=B.children().first().outerWidth(true),C=B.width();B.attr("data-per-row",Math.floor(C/A))}function n(C){var A=C.is(":checked");var B=C.parents(".gridImages").find(".gridImage__deletebox");if(A){B.prop("checked","checked").change()}else{B.removeAttr("checked").change()}}var g=function(){var A=function(){var B=f(this),C=k(B);if(C.length){t(B);m(o(C),C)}};f(".gridImages").each(A)};function v(A){if(A.is(":checked")){A.parents(".ImageOuter").addClass("gridImage--delete")}else{A.parents(".ImageOuter").removeClass("gridImage--delete")}}function z(A){A.parents(".gridImage").toggleClass("gridImage--delete");A.find("input").prop("checked",j)}function q(D,A){var C=A.find(".InputfieldImageEdit__image");C.attr({src:D.find("img").attr("data-original"),"data-original":D.find("img").attr("data-original"),alt:D.find("img").attr("alt")});var B=u;B.callbacks={elementParse:function(E){E.src=f(E.el).attr("data-original")}};B.gallery={enabled:true};A.parents(".gridImages").find(".gridImage").not(D).find("img").add(C).magnificPopup(B);A.find(".InputfieldImageEdit__edit").attr("data-current",D.attr("id")).append(D.find(".ImageData").children().not(".InputfieldFileSort, .InputfieldFileReplace"))}function h(A){$inputArea=A.find(".InputfieldImageEdit__edit");if($inputArea.children().not(".InputfieldFileSort, .InputfieldFileReplace").length){f("#"+$inputArea.attr("data-current")).find(".ImageData").append($inputArea.children())}}function e(C,B){var A;if(C){A=C.find(".InputfieldImageEdit--active")}else{if(B){A=f(".InputfieldImageEdit--active").not(B.find(".InputfieldImageEdit--active"))}else{A=f(".InputfieldImageEdit--active")}}if(A.length){h(A);A.removeClass("InputfieldImageEdit--active");f("#"+A.attr("data-for")).removeClass("gridImageEditing")}f(".InputfieldImageEdit__replace").removeClass("InputfieldImageEdit__replace")}function m(F,B){if(!F||!F.length){return}t(F.parent());var A=F.parent().children().not(".InputfieldImageEdit"),G=parseInt(F.parent().attr("data-per-row")),C=A.index(F);for(var E=0;E<30;E++){if(C%G!==G-1){C++}else{continue}}C=Math.min(C,A.length-1);B.insertAfter(A.eq(C));var D=B.find(".InputfieldImageEdit__arrow");if(D.length){D.css("left",F.position().left+(F.outerWidth()/2)+"px")}}function y(){f(window).resize(i(g,200));f(document).on("click dblclick",".gridImage__trash",function(A){var B=f(this).find("input");B.prop("checked",j).change();if(A.type=="dblclick"){n(B)}});f(document).on("change",".gridImage__deletebox",function(){v(f(this))});f(document).on("click",".gridImage__edit",function(D){var B=f(this).closest(".gridImage");if(!B.length){return}var C=B.closest(".gridImages");var A=C.find(".InputfieldImageEdit");if(B.hasClass("gridImageEditing")){A.find(".InputfieldImageEdit__close").click()}else{m(B,A);h(A);q(B,A);A.addClass("InputfieldImageEdit--active").attr("data-for",B.attr("id"));C.find(".gridImageEditing").removeClass("gridImageEditing");B.addClass("gridImageEditing")}});f(document).on("click",function(B){var A=f(B.target);if(A.closest(".InputfieldImageEdit").length){e(null,A.parents(".gridImages"))}else{if(A.closest(".gridImage__inner").length){e(null,A.parents(".gridImages"))}else{if(A.closest(".mfp-container").length){return}else{if(A.closest(".ui-dialog").length){return}else{if(A.is(".mfp-close")){return}else{e(null,null)}}}}}});f(".InputfieldImageEdit").on("click",".InputfieldImageEdit__close",function(A){e(f(this).parents(".gridImages"),null)});f(".ImagesGrid").on("click","button.pw-modal",function(A){A.preventDefault()})}function l(A){var B=parseInt(A.find(".InputfieldImageMaxFiles").val());if(A.hasClass("InputfieldRenderValue")){return d(A)}else{if(B==1){A.addClass("InputfieldImageMax1");r(A)}else{x(A.find(".gridImages"))}}}function b(){f("body").addClass("ie-no-drop");f(".InputfieldImage.InputfieldFileMultiple").each(function(){var B=f(this),D=parseInt(B.find(".InputfieldFileMaxFiles").val()),A=B.find(".gridImages"),C=B.find(".InputfieldImageUpload");C.on("change","input[type=file]",function(){var H=f(this),F=H.parent(".InputMask");if(H.val().length>1){F.addClass("ui-state-disabled")}else{F.removeClass("ui-state-disabled")}if(H.next("input.InputfieldFile").length>0){return}var E=A.children("li").length+C.find("input[type=file]").length+1;if(D>0&&E>=D){return}C.find(".InputMask").not(":last").each(function(){var I=f(this);if(I.find("input[type=file]").val()<1){I.remove()}});var G=F.clone().removeClass("ui-state-disabled");G.children("input[type=file]").val("");G.insertAfter(F)})})}function w(C){var B;if(C.length>0){B=C.find(".InputfieldImageUpload")}else{B=f(".InputfieldImageUpload")}B.each(function(F){var E=f(this).closest(".InputfieldContent");if(E.hasClass("InputfieldFileInit")){return}D(E,F);E.addClass("InputfieldFileInit")});function D(N,X){var M=N.parents("form");var H=M.attr("action");H+=(H.indexOf("?")>-1?"&":"?")+"InputfieldFileAjax=1";var ab=M.find("input._post_token");var L=ab.attr("name");var Q=ab.val();var P=N.find(".InputfieldImageErrors").first();var G=N.find(".InputfieldImageUpload").data("fieldname");G=G.slice(0,-2);var aa=N.find(".InputfieldImageUpload").data("extensions").toLowerCase();var W=N.find(".InputfieldImageUpload").data("maxfilesize");var O=N.find("input[type=file]").get(0);var F=N.find(".gridImages");var Y=F.get(0);var S=F.data("gridsize");var T=null;var R=parseInt(N.find(".InputfieldImageMaxFiles").val());Z(N);if(R!=1){V(F)}K();F.children().addClass("InputfieldFileItemExisting");function K(){$dropHere=N.find(".AjaxUploadDropHere");$dropHere.show().click(function(){var ac=f(this).find(".InputfieldImageRefresh");if(ac.is(":visible")){ac.hide().siblings("span").show();f(this).find("input").val("0")}else{ac.show().siblings("span").hide();f(this).find("input").val("1")}})}function J(ad,ac){if(typeof ac!=="undefined"){ad="<b>"+ac+":</b> "+ad}return"<li>"+ad+"</li>"}function E(ad){var ac=new String(ad).substring(ad.lastIndexOf("/")+1);if(ac.lastIndexOf(".")!=-1){ac=ac.substring(0,ac.lastIndexOf("."))}return ac}function Z(ac){var ad=ac.get(0);ad.addEventListener("dragleave",function(){ac.removeClass("ui-state-hover")},false);ad.addEventListener("dragenter",function(){ac.addClass("ui-state-hover")},false);ad.addEventListener("dragover",function(ae){if(!ac.is("ui-state-hover")){ac.addClass("ui-state-hover")}ae.preventDefault();ae.stopPropagation();return false},false);ad.addEventListener("drop",function(ae){U(ae.dataTransfer.files);ac.removeClass("ui-state-hover");ae.preventDefault();ae.stopPropagation();return false},false)}function V(ai){var al=null;var ak=false;var ad=null;function ac(){return ai.find(".InputfieldImageEdit--active").length==0}function ag(an){var ar=an.offset();var ao=an.width();var am=an.height();var aq=ar.left+ao/2;var ap=ar.top+am/2;return{clientX:aq,clientY:ap}}function ah(an){ak=false;an.preventDefault();if(!ac()){return}if(al==null){var am=ai.attr("data-gridsize")+"px";var ao=f("<div/>").addClass("gridImage__overflow").css({width:am,height:am});al=f("<li/>").addClass("ImageOuter gridImage gridImagePlaceholder").append(ao);ai.append(al)}var ap=ag(al);al.simulate("mousedown",ap)}function aj(am){ak=false;if(al==null){return}am.preventDefault();if(!ac()){return}var an={clientX:am.originalEvent.clientX,clientY:am.originalEvent.clientY};al.simulate("mousemove",an)}function af(am){if(al==null){return false}if(!ac()){return}ak=true;if(ad){clearTimeout(ad)}ad=setTimeout(function(){if(!ak||al==null){return}al.remove();al=null},1000)}function ae(am){ak=false;if(!ac()){return}var an={clientX:am.clientX,clientY:am.clientY};al.simulate("mouseup",an);p=al.next(".gridImage");al.remove();al=null}if(ai.length){ai.on("dragenter",ah);ai.on("dragover",aj);ai.on("dragleave",af);ai[0].addEventListener("drop",ae)}}function I(au){var ar=ProcessWire.config.InputfieldImage.labels;var af=parseInt(au.size/1024,10)+"&nbsp;kB";var at='<div class="gridImage__tooltip"><table><tbody><tr><th>'+ar.dimensions+'</th><td class="dimensions">'+ar.na+"</td></tr><tr><th>"+ar.filesize+"</th><td>"+af+"</td></tr><tr><th>"+ar.variations+"</th><td>0</td></tr></tbody></table></div>";var aw=f('<li class="gridImage"></li>'),ao=f(at),ah=f('<div class="gridImage__overflow"></div>'),aj=f('<img width="184" height="130" alt="">'),ac=f('<div class="ImageData"></div>'),al=f("<div class='gridImage__hover'><div class='gridImage__inner'></div></div>"),am=f("<progress class='gridImage__progress' min='-1' max='100' value='0'></progress>"),aq=f('<a class="gridImage__edit" title="'+au.name+'"><span>'+ar.details+"</span></a>"),ap=f('<div class="gridImage__resize"><i class="fa fa-spinner fa-spin fa-2x fa-fw"></i></div>'),ax,ad,ai,av,ak=URL.createObjectURL(au),ae=R==1;ah.append(aj);al.find(".gridImage__inner").append(aq);al.find(".gridImage__inner").append(ap.css("display","none"));al.find(".gridImage__inner").append(am);ac.append(f('<h2 class="InputfieldImageEdit__name">'+au.name+'</h2><span class="InputfieldImageEdit__info">'+af+"</span>"));ah.css({width:S+"px",height:S+"px"});aw.append(ao).append(ah).append(al).append(ac);aj.attr({src:ak,"data-original":ak});ax=new Image();ax.addEventListener("load",function(){ao.find(".dimensions").html(this.width+"&nbsp;&times;&nbsp;"+this.height);var ay=Math.min(this.width,this.height)/S;aj.attr({width:this.width/ay,height:this.height/ay})},false);ax.src=ak;ai=new XMLHttpRequest();ai.upload.addEventListener("progress",function(ay){if(!ay.lengthComputable){return}am.attr("value",parseInt((ay.loaded/ay.total)*100));ap.css("display","block")},false);ai.addEventListener("load",function(){var az=f.parseJSON(ai.responseText),aC=az.length>1;if(az.error!==undefined){az=[az]}for(var aE=0;aE<az.length;aE++){var aB=az[aE];if(aB.error){P.append(J(aB.message));continue}var ay=null;var aA=f(aB.markup).hide();var aD=N.find("input[type=file]");if(aD.val()){aD.replaceWith(aD.clone(true))}if(aB.overwrite){ay=F.children("#"+aA.attr("id"))}if(aB.replace||ae){ay=F.find(".InputfieldImageEdit:eq(0)")}if(c.item&&az.length==1&&!ae){ay=c.item}if(ay&&ay.length){ay.replaceWith(aA)}else{if(p&&p.length){p.before(aA);p=aA}else{if(aE===0){aw.replaceWith(aA)}else{F.append(aA)}}}aA.fadeIn().css("display","");aA.addClass("InputfieldFileItemExisting");if(ay&&ay.length){aA.effect("highlight",500)}if(aw.length){aw.remove()}if(c.item&&!ae){aA.find(".gridImage__edit").click();aA.find(".InputfieldFileReplace").val(c.file)}c.file="";c.item=null;c.edit=null}if(T){clearTimeout(T)}p=null;T=setTimeout(function(){if(R!=1){x(F)}else{r(F.closest(".Inputfield"))}F.trigger("AjaxUploadDone")},500)},false);if(c.edit){c.edit.find(".InputfieldImageEdit__close").click()}ai.open("POST",H,true);ai.setRequestHeader("X-FILENAME",encodeURIComponent(au.name));ai.setRequestHeader("X-FIELDNAME",G);ai.setRequestHeader("Content-Type","application/octet-stream");ai.setRequestHeader("X-"+L,Q);ai.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");ai.send(au);if(c.item){c.item.replaceWith(aw);c.item=aw}else{if(p&&p.length){p.before(aw)}else{F.append(aw)}}g();var an=F.closest(".Inputfield");an.addClass("InputfieldStateChanged");var ag=an.find(".InputfieldFileItem").length;if(ag==1){an.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileMultiple").addClass("InputfieldFileSingle")}else{if(ag>1){an.removeClass("InputfieldFileEmpty").removeClass("InputfieldFileSingle").addClass("InputfieldFileMultiple")}}}function U(ag){var ad=function(ak){return parseInt(ak/1024,10)};if(typeof ag==="undefined"){Y.innerHTML="No support for the File API in this web browser";return}for(var ae=0,ac=ag.length;ae<ac;ae++){var aj=ag[ae].name.split(".").pop().toLowerCase();var af;if(aa.indexOf(aj)==-1){af=aj+" is a invalid file extension, please use one of:  "+aa;P.append(J(af,ag[ae].name))}else{if(ag[ae].size>W&&W>2000000){var ai=ad(ag[ae].size),ah=ad(W);af="Filesize "+ai+" kb is too big. Maximum allowed is "+ah+" kb";P.append(J(af,ag[ae].name))}else{I(ag[ae])}}if(R==1){break}}}O.addEventListener("change",function(ac){U(this.files);ac.preventDefault();ac.stopPropagation();this.value=""},false)}function A(){var E=".InputfieldImageEdit__imagewrapper img";f(document).on("dragenter",E,function(){var H=f(this);if(H.closest(".InputfieldImageMax1").length){return}var I=H.attr("src");var F=H.closest(".InputfieldImageEdit");var G=H.closest(".InputfieldImageEdit__imagewrapper");G.addClass("InputfieldImageEdit__replace");c.file=new String(I).substring(I.lastIndexOf("/")+1);c.item=f("#"+F.attr("data-for"));c.edit=F}).on("dragleave",E,function(){var G=f(this);if(G.closest(".InputfieldImageMax1").length){return}var F=G.closest(".InputfieldImageEdit__imagewrapper");F.removeClass("InputfieldImageEdit__replace");c.file="";c.item=null;c.edit=null})}A()}function s(){f(".InputfieldImage.Inputfield").each(function(){l(f(this))});y();if(a()){w("")}else{b()}f(document).on("reloaded",".InputfieldImage",function(){var A=f(this);l(A);w(A)})}s()}jQuery(document).ready(function(a){InputfieldImage(a)});