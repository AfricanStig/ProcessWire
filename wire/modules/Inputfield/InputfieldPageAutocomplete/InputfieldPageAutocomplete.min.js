var InputfieldPageAutocomplete={init:function(p,d,h,o,j){var e=$("#"+p);var k=$("#"+p+"_items");var b=$("#"+p+"_input");var a=b.parent().find(".InputfieldPageAutocompleteStatus");var i=b.parent().find(".InputfieldPageAutocompleteNote");var g=0;var m=0;var q=b.attr("data-disablechars");var l=a.height();if(l){var f=a.parent().height();var n=((f-l)/2);a.css("top",n+"px");a.css("left",(n/2)+"px")}else{}if(b.hasClass("no_list")){b.attr("data-selectedLabel",b.val());var c=b.siblings(".InputfieldPageAutocompleteRemove");c.click(function(){e.val("").change();b.val("").attr("placeholder","").attr("data-selectedLabel","").change().focus()});b.change(function(){if($(this).val().length==0){c.hide()}else{c.show()}});b.focus(function(){if(e.val().length){$(this).attr("placeholder",$(this).attr("data-selectedLabel"))}$(this).val("")}).blur(function(){setTimeout(function(){},200)})}a.click(function(){b.focus()});a.attr("data-class",a.attr("class"));function s(){return $("#_"+k.attr("data-name")+"_add_items").size()>0}b.autocomplete({minLength:2,source:function(w,t){if(q&&q.length){var u=false;var v=w.term;for(var y=0;y<q.length;y++){if(v.indexOf(q[y])>-1){u=true;break}}if(u){t([]);return}}a.attr("class","fa fa-fw fa-spin fa-spinner");var v=w.term;if(b.hasClass("and_words")&&v.indexOf(" ")>0){v=v.replace(/\s+/,",")}var x=d+"&"+o+j+v;$.getJSON(x,function(z){a.attr("class",a.attr("data-class"));m=z.total;if(z.total>0){a.attr("class","fa fa-fw fa-angle-double-down")}else{if(s()){a.attr("class","fa fa-fw fa-plus-circle");i.show()}else{a.attr("class","fa fa-fw fa-frown-o")}}t($.map(z.matches,function(A){return{label:A[h],value:A[h],page_id:A.id}}))})},select:function(t,u){if(!u.item){return}var v=$(this);if(v.hasClass("no_list")){v.val(u.item.label).change();v.attr("data-selectedLabel",u.item.label);v.closest(".InputfieldPageAutocomplete").find(".InputfieldPageAutocompleteData").val(u.item.page_id).change();v.blur();return false}else{InputfieldPageAutocomplete.pageSelected(k,u.item);v.val("").focus();return false}}}).blur(function(){var t=$(this);a.attr("class",a.attr("data-class"));i.hide();if(t.hasClass("no_list")){if(e.val().length){t.val(t.attr("data-selectedLabel")).attr("placeholder","")}else{t.val("").attr("placeholder","").attr("data-selectedLabel","")}}}).keyup(function(){a.attr("class",a.attr("data-class"))}).keydown(function(t){if(t.keyCode==13){t.preventDefault();if(s()){if($.trim(b.val()).length<1){b.blur();return false}g++;var u={page_id:(-1*g),label:b.val()};InputfieldPageAutocomplete.pageSelected(k,u);b.val("").blur().focus();i.hide()}else{$(this).blur()}return false}});var r=function(t){t.sortable({axis:"y",update:function(v,u){InputfieldPageAutocomplete.rebuildInput($(this))},start:function(v,u){u.item.addClass("ui-state-highlight")},stop:function(v,u){u.item.removeClass("ui-state-highlight")}});t.addClass("InputfieldPageAutocompleteSortable")};$("#"+k.attr("id")).on("mouseover",">li",function(){$(this).removeClass("ui-state-default").addClass("ui-state-hover");r(k)}).on("mouseout",">li",function(){$(this).removeClass("ui-state-hover").addClass("ui-state-default")})},initFromInputfield:function(a){var b=a.find(".InputfieldPageAutocompleteData");if(!b.length){return}if(b.hasClass("InputfieldPageAutocompleteInit")){return}InputfieldPageAutocomplete.init(b.attr("id"),b.attr("data-url"),b.attr("data-label"),b.attr("data-search"),b.attr("data-operator"));b.addClass("InputfieldPageAutocompleteInit")},pageSelected:function(a,d){var c=false;a.children("li").each(function(){var f=parseInt($(this).children(".itemValue").text());if(f==d.page_id){c=$(this)}});var b=$("#"+a.attr("data-id")+"_input");b.blur();if(c){c.effect("highlight");return}var e=a.children(".itemTemplate").clone();e.removeClass("itemTemplate");e.children(".itemValue").text(d.page_id);e.children(".itemLabel").text(d.label);a.append(e);InputfieldPageAutocomplete.rebuildInput(a)},rebuildInput:function(d){var b=d.attr("data-id");var a=d.attr("data-name");var f=$("#"+b);var h="";var c="";var g=parseInt(f.attr("data-max"));var i=d.children(":not(.itemTemplate)");if(g>0&&i.size()>g){while(i.size()>g){i=i.slice(1)}d.children(":not(.itemTemplate)").replaceWith(i)}i.each(function(){var j=parseInt($(this).children(".itemValue").text());if(j>0){h+=","+j}else{if(j<0){h+=","+j;c+=$(this).children(".itemLabel").text()+"\n"}}});f.val(h);var e=$("#_"+a+"_add_items");if(e.size()>0){e.val(c)}}};$(document).ready(function(){$(".InputfieldPageAutocomplete").each(function(){InputfieldPageAutocomplete.initFromInputfield($(this))});$(document).on("reloaded",".InputfieldPageAutocomplete, .InputfieldPage",function(){InputfieldPageAutocomplete.initFromInputfield($(this));return false});$(document).on("click",".InputfieldPageAutocomplete ol a.itemRemove",function(){var c=$(this).parent();var a=c.parent();var b=c.children(".itemValue").text();c.remove();InputfieldPageAutocomplete.rebuildInput(a);return false})});