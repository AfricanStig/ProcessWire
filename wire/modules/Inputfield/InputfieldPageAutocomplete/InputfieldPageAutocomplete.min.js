var InputfieldPageAutocomplete={init:function(q,d,h,p,j){var e=$("#"+q);var k=$("#"+q+"_items");var b=$("#"+q+"_input");var a=b.parent().find(".InputfieldPageAutocompleteStatus");var i=b.parent().find(".InputfieldPageAutocompleteNote");var g=0;var m=0;var r=b.attr("data-disablechars");var l=a.height();if(l){var f=a.parent().height();var n=((f-l)/2);a.css("top",n+"px");a.css("left",(n/2)+"px")}else{}function o(v){if(!r||!r.length){return false}var u=false;for(var w=0;w<r.length;w++){if(v.indexOf(r[w])>-1){u=true;break}}return u}if(b.hasClass("no_list")){b.attr("data-selectedLabel",b.val());var c=b.siblings(".InputfieldPageAutocompleteRemove");c.click(function(){e.val("").change();b.val("").attr("placeholder","").attr("data-selectedLabel","").change().focus()});b.change(function(){if($(this).val().length==0){c.hide()}else{c.show()}});b.focus(function(){var u=e.val();if(!u.length){return}if(o(u)){return}$(this).attr("placeholder",$(this).attr("data-selectedLabel"));$(this).val("")}).blur(function(){setTimeout(function(){},200)})}a.click(function(){b.focus()});a.attr("data-class",a.attr("class"));function t(){return $("#_"+k.attr("data-name")+"_add_items").size()>0}b.autocomplete({minLength:2,source:function(w,u){var v=w.term;if(o(v)){u([]);return}a.attr("class","fa fa-fw fa-spin fa-spinner");if(b.hasClass("and_words")&&v.indexOf(" ")>0){v=v.replace(/\s+/,",")}var x=d+"&"+p+j+v;$.getJSON(x,function(y){a.attr("class",a.attr("data-class"));m=y.total;if(y.total>0){a.attr("class","fa fa-fw fa-angle-double-down")}else{if(t()){a.attr("class","fa fa-fw fa-plus-circle");i.show()}else{a.attr("class","fa fa-fw fa-frown-o")}}u($.map(y.matches,function(z){return{label:z[h],value:z[h],page_id:z.id}}))})},select:function(u,v){if(!v.item){return}var w=$(this);if(w.hasClass("no_list")){w.val(v.item.label).change();w.attr("data-selectedLabel",v.item.label);w.closest(".InputfieldPageAutocomplete").find(".InputfieldPageAutocompleteData").val(v.item.page_id).change();w.blur();return false}else{InputfieldPageAutocomplete.pageSelected(k,v.item);w.val("").focus();return false}}}).blur(function(){var u=$(this);a.attr("class",a.attr("data-class"));i.hide();if(u.hasClass("no_list")){if(e.val().length){if(u.hasClass("allow_any")){}else{u.val(u.attr("data-selectedLabel")).attr("placeholder","")}}else{u.val("").attr("placeholder","").attr("data-selectedLabel","")}}}).keyup(function(){a.attr("class",a.attr("data-class"))}).keydown(function(u){if(u.keyCode==13){u.preventDefault();if(t()){if($.trim(b.val()).length<1){b.blur();return false}g++;var v={page_id:(-1*g),label:b.val()};InputfieldPageAutocomplete.pageSelected(k,v);b.val("").blur().focus();i.hide()}else{$(this).blur()}return false}});var s=function(u){u.sortable({axis:"y",update:function(w,v){InputfieldPageAutocomplete.rebuildInput($(this))},start:function(w,v){v.item.addClass("ui-state-highlight")},stop:function(w,v){v.item.removeClass("ui-state-highlight")}});u.addClass("InputfieldPageAutocompleteSortable")};$("#"+k.attr("id")).on("mouseover",">li",function(){$(this).removeClass("ui-state-default").addClass("ui-state-hover");s(k)}).on("mouseout",">li",function(){$(this).removeClass("ui-state-hover").addClass("ui-state-default")})},initFromInputfield:function(a){var b=a.find(".InputfieldPageAutocompleteData");if(!b.length){return}if(b.hasClass("InputfieldPageAutocompleteInit")){return}InputfieldPageAutocomplete.init(b.attr("id"),b.attr("data-url"),b.attr("data-label"),b.attr("data-search"),b.attr("data-operator"));b.addClass("InputfieldPageAutocompleteInit")},pageSelected:function(a,d){var c=false;a.children("li").each(function(){var f=parseInt($(this).children(".itemValue").text());if(f==d.page_id){c=$(this)}});var b=$("#"+a.attr("data-id")+"_input");b.blur();if(c){c.effect("highlight");return}var e=a.children(".itemTemplate").clone();e.removeClass("itemTemplate");e.children(".itemValue").text(d.page_id);e.children(".itemLabel").text(d.label);a.append(e);InputfieldPageAutocomplete.rebuildInput(a)},rebuildInput:function(d){var b=d.attr("data-id");var a=d.attr("data-name");var f=$("#"+b);var h="";var c="";var g=parseInt(f.attr("data-max"));var i=d.children(":not(.itemTemplate)");if(g>0&&i.size()>g){while(i.size()>g){i=i.slice(1)}d.children(":not(.itemTemplate)").replaceWith(i)}i.each(function(){var j=parseInt($(this).children(".itemValue").text());if(j>0){h+=","+j}else{if(j<0){h+=","+j;c+=$(this).children(".itemLabel").text()+"\n"}}});f.val(h);var e=$("#_"+a+"_add_items");if(e.size()>0){e.val(c)}}};$(document).ready(function(){$(".InputfieldPageAutocomplete").each(function(){InputfieldPageAutocomplete.initFromInputfield($(this))});$(document).on("reloaded",".InputfieldPageAutocomplete, .InputfieldPage",function(){InputfieldPageAutocomplete.initFromInputfield($(this))});$(document).on("click",".InputfieldPageAutocomplete ol a.itemRemove",function(){var c=$(this).parent();var a=c.parent();var b=c.children(".itemValue").text();c.remove();InputfieldPageAutocomplete.rebuildInput(a);return false})});