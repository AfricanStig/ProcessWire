$(document).ready(function(){if(config.ProcessPageList){$("#"+config.ProcessPageList.containerID).ProcessPageList(config.ProcessPageList)}});(function(a){a.fn.ProcessPageList=function(b){var c={mode:"",limit:35,rootPageID:0,showRootPage:true,selectedPageID:0,adminPageID:2,trashPageID:7,langID:0,selectAllowUnselect:false,selectShowPageHeader:true,selectShowPath:true,selectStartLabel:"Change",selectCancelLabel:"Cancel",selectSelectLabel:"Select",selectUnselectLabel:"Unselect",moreLabel:"More",trashLabel:"Trash",moveInstructionLabel:"Click and drag to move",selectSelectHref:"#",selectUnselectHref:"#",ajaxURL:config.urls.admin+"page/list/",ajaxMoveURL:config.urls.admin+"page/sort/",openPagination:0,openPageIDs:[],speed:200};a.extend(c,b);return this.each(function(i){var o=a(this);var w;var n=a("<span class='PageListLoading'></span>");var x=0;var d=0;var e=false;function r(){w=a("<div class='PageListRoot'></div>");if(o.is(":input")){c.selectedPageID=o.val();if(!c.selectedPageID.length){c.selectedPageID=0}c.mode="select";o.before(w);u()}else{c.mode="actions";o.append(w);j(c.rootPageID>0?c.rootPageID:1,w,0,true)}}function u(){var y=a("<ul></ul>").addClass("PageListActions PageListSelectActions actions");var z=a("<p></p>").addClass("PageListSelectName");if(c.selectShowPageHeader){z.append(n)}var A=a("<a></a>").addClass("PageListSelectActionToggle").attr("href","#").text(c.selectStartLabel).click(function(){if(a(this).text()==c.selectStartLabel){j(c.rootPageID>0?c.rootPageID:1,w,0,true);a(this).text(c.selectCancelLabel)}else{w.children(".PageList").slideUp(c.speed,function(){a(this).remove()});a(this).text(c.selectStartLabel)}return false});y.append(a("<li></li>").append(A));w.append(a("<div></div>").addClass("PageListSelectHeader").append(z).append(y));if(c.selectShowPageHeader){a.getJSON(c.ajaxURL+"?id="+c.selectedPageID+"&render=JSON&start=0&limit=0&lang="+c.langID+"&mode="+c.mode,function(D){var B="";if(c.selectShowPath){B=D.page.path;B=B.substring(0,B.length-1);B=B.substring(0,B.lastIndexOf("/")+1);B='<span class="detail">'+B+"</span> "}var C=c.selectedPageID>0?B+D.page.label:"";w.children(".PageListSelectHeader").find(".PageListSelectName").html(C)})}}function q(){e=false}function s(y,z,F,J){var H=9;var A=Math.ceil(J/F);d=z>=F?Math.floor(z/F):0;if(d==0){x=0}else{if((d-H+1)>x){x=d-Math.floor(H/2)}else{if(x>0&&d==x){x=d-Math.ceil(H/2)}}}if(x>A-H){x=A-H}if(x<0){x=0}var G=a("<ul></ul>").addClass("PageListPagination").data("paginationInfo",{start:z,limit:F,total:J});var I=function(R){var M=a(this).parents("ul.PageListPagination");var Q=M.data("paginationInfo");if(!Q){return false}var N=s(y,parseInt(a(this).attr("href"))*Q.limit,Q.limit,Q.total);var P=a("<li><span class='PageListLoading'></span></li>");M.siblings(".PageList").remove();M.replaceWith(N);N.append(P);var O=N.siblings().css("opacity",0.5);j(y,N.parent(),a(this).attr("href")*Q.limit,false,false,true,function(){P.remove()});return false};var E=null;var B=null;for(var L=x,C=0;L<A;L++,C++){var D=a("<a></a>").html(L+1).attr("href",L).addClass("ui-state-default");var K=a("<li></li>").addClass("PageListPagination"+C).append(D);if(L==d){K.addClass("PageListPaginationCurrent").find("a").removeClass("ui-state-default").addClass("ui-state-active")}G.append(K);if(!B){B=K.clone().removeClass("PageListPaginationCurrent ui-state-active");B.find("a").removeClass("ui-state-active").addClass("ui-state-default")}if(!E){E=B.clone().removeClass("ui-state-default").html("&hellip;")}if(C>=H&&L<A){$lastItem=B.clone();$lastItem.find("a").text(A).attr("href",A-1);G.append(E.clone()).append($lastItem);break}}if(x>0){$firstItem=B.clone();$firstItem.find("a").text("1").attr("href","0").click(I);G.prepend(E.clone()).prepend($firstItem)}if(d+1<A){$nextBtn=B.clone();$nextBtn.find("a").html("<i class='fa fa-angle-right'></i>").attr("href",d+1);G.append($nextBtn)}if(d>0){$prevBtn=B.clone();$prevBtn.find("a").attr("href",d-1).html("<i class='fa fa-angle-left'></i>");G.prepend($prevBtn)}G.find("a").click(I).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});return G}function j(F,y,E,D,z,A,C){if(z==undefined){z=true}if(A==undefined){A=false}var B=function(K){if(K&&K.error){alert(K.message);n.hide();e=false;return}var G=h(a(K.children));var J=K.start+K.limit;if(K.page.numChildren>J){var I=a("<a></a>").attr("href",J).data("pageId",F).text(c.moreLabel).click(v);G.append(a("<ul></ul>").addClass("PageListActions actions").append(a("<li></li>").addClass("PageListActionMore").append(I)));if(z){G.prepend(s(F,K.start,K.limit,K.page.numChildren))}}G.hide();if(D){var L;L=h(a(K.page));if(c.showRootPage){L.children(".PageListItem").addClass("PageListItemOpen")}else{L.children(".PageListItem").hide().parent(".PageList").addClass("PageListRootHidden")}L.append(G);y.append(L)}else{if(y.is(".PageList")){var H=G.children(".PageListItem, .PageListActions");if(A){y.children(".PageListItem, .PageListActions").replaceWith(H)}else{y.append(H)}}else{y.after(G)}}n.hide();if(A){G.show();q();if(C!=undefined){C()}}else{G.slideDown(c.speed,function(){q();if(C!=undefined){C()}})}if(c.openPagination>1){var I=a(".PageListPagination a[href="+(c.openPagination-1)+"]");if(I.size()>0){I.click();c.openPagination=0}else{a(".PageListPagination9 a").click()}}};if(!A){y.append(n.show())}a.getJSON(c.ajaxURL+"?id="+F+"&render=JSON&start="+E+"&lang="+c.langID+"&open="+c.openPageIDs[0]+"&mode="+c.mode).done(function(H,I,G){B(H)}).fail(function(G,I,H){B({error:1,message:!G.status?c.ajaxNetworkError:c.ajaxUnknownError})})}function h(y){var A=a("<div></div>").addClass("PageList");var z=A;y.each(function(C,B){z.append(f(B))});a("a.PageListPage",z).click(m);a(".PageListActionMove a",z).click(g);a(".PageListActionSelect a",z).click(t);a(".PageListTriggerOpen a.PageListPage",z).click();return A}function f(D){var C=a("<div></div>").data("pageId",D.id).addClass("PageListItem").addClass("PageListTemplate_"+D.template);var B=a("<a></a>").attr("href","#").attr("title",D.path).html(D.label).addClass("PageListPage label");C.addClass("PageListID"+D.id);if(D.status==0){C.addClass("PageListStatusOff disabled")}if(D.status&2048){C.addClass("PageListStatusUnpublished secondary")}if(D.status&1024){C.addClass("PageListStatusHidden secondary")}if(D.status&512){C.addClass("PageListStatusTemp secondary")}if(D.status&16){C.addClass("PageListStatusSystem")}if(D.status&8){C.addClass("PageListStatusSystem")}if(D.status&4){C.addClass("PageListStatusLocked")}if(D.addClass&&D.addClass.length){C.addClass(D.addClass)}if(D.type&&D.type.length>0){if(D.type=="System"){C.addClass("PageListStatusSystem")}}if(D.rm){C.addClass("trashable")}a(c.openPageIDs).each(function(F,E){if(D.id==E){C.addClass("PageListTriggerOpen")}});C.append(B);var z=a("<span>"+(D.numChildren?D.numChildren:"")+"</span>").addClass("PageListNumChildren detail");C.append(z);if(D.note&&D.note.length){C.append(a("<span>"+D.note+"</span>").addClass("PageListNote detail"))}var A=a("<ul></ul>").addClass("PageListActions actions");var y=c.rootPageID==D.id?[]:[{name:c.selectSelectLabel,url:c.selectSelectHref}];if(c.mode=="actions"){y=D.actions}else{if(c.selectAllowUnselect){if(D.id==o.val()){y=[{name:c.selectUnselectLabel,url:c.selectUnselectHref}]}}}a(y).each(function(G,F){if(F.name==c.selectSelectLabel){actionName="Select"}else{if(F.name==c.selectUnselectLabel){actionName="Select"}else{actionName=F.cn}}var E=a("<a></a>").html(F.name).attr("href",F.url);A.append(a("<li></li>").addClass("PageListAction"+actionName).append(E))});C.append(A);return C}function m(y){var B=a(this);var A=B.parent(".PageListItem");var z=A.data("pageId");if(e&&!A.is(".PageListTriggerOpen")){return false}if(w.is(".PageListSorting")||w.is(".PageListSortSaving")){return false}if(A.is(".PageListItemOpen")){A.removeClass("PageListItemOpen").next(".PageList").slideUp(c.speed,function(){a(this).remove()})}else{A.addClass("PageListItemOpen");if(parseInt(A.children(".PageListNumChildren").text())>0){e=true;j(z,A,0,false)}}return false}function v(B){var D=a(this);var z=D.parent("li").parent("ul.PageListActions");var y=z.parent(".PageList");var C=D.data("pageId");var A=parseInt(D.attr("href"));j(C,y,A,false);z.remove();return false}function g(){if(e){return false}var F=a(this);var E=F.parent("li").parent("ul.PageListActions").parent(".PageListItem");if(E.hasClass("PageListItemOpen")){E.children(".PageListPage").click()}w.find(".PageListItemOpen").each(function(){var H=a(this).children(".PageListNumChildren").text();if(parseInt(H)>1&&a(this).next().find(".PageList:visible").size()==0){return}var G=a("<div></div>").addClass("PageListPlaceholder").addClass("PageList");G.append(a("<div></div>").addClass("PageListItem PageListPlaceholderItem").html("&nbsp;"));a(this).after(G)});var D={stop:k,helper:"PageListItemHelper",items:".PageListItem:not(.PageListItemOpen)",placeholder:"PageListSortPlaceholder",start:function(H,G){a(".PageListSortPlaceholder").css("width",G.item.children(".PageListPage").outerWidth()+"px")}};var A=w.children(".PageList").children(".PageList");var y=a("<a href='#'>"+c.selectCancelLabel+"</a>").click(function(){return l(E)});var C=E.children("ul.PageListActions");var B=a("<span class='PageListMoveNote detail'><i class='fa fa-fw fa-sort'></i> "+c.moveInstructionLabel+"<i class='fa fa-fw fa-angle-left'></i></span>");B.append(y);if(E.hasClass("trashable")){var z=a("<a class='PageListActionTrash ui-priority-secondary' href='#'><i class='fa fa-trash-o'></i> "+c.trashLabel+"</i></a>").click(function(){p(E);return false});E.addClass("ui-helper-clearfix");B.append(z)}C.before(B);E.addClass("PageListSortItem");E.parent(".PageList").attr("id","PageListMoveFrom");w.addClass("PageListSorting");A.addClass("PageListSortingList").sortable(D);return false}function l(z){var y=w.find(".PageListSortingList");y.sortable("destroy").removeClass("PageListSortingList");z.removeClass("PageListSortItem").parent(".PageList").removeAttr("id");z.find(".PageListMoveNote").remove();w.find(".PageListPlaceholder").remove();w.removeClass("PageListSorting");return false}function p(B){var y=w.find(".PageListID"+c.trashPageID);if(!y.hasClass("PageListItemOpen")){w.removeClass("PageListSorting");y.children("a").click();w.addClass("PageListSorting")}var z=y.next(".PageList");if(z.length==0){z=a("<div class='PageList'></div>");y.after(z)}z.prepend(B);var A={item:B};k(null,A)}function k(E,J){var G=J.item;var B=G.children(".PageListPage");var z=parseInt(G.data("pageId"));var D=G.parent(".PageList");var H=a("#PageListMoveFrom");var I=D.prev().is(".PageListItem")?D.prev():D.prev().prev();var F=parseInt(I.data("pageId"));var A=G.prev(".PageListItem");if(A.is(".PageListItemOpen")){return false}if(D.is(".PageListPlaceholder")){D.removeClass("PageListPlaceholder").children(".PageListPlaceholderItem").remove()}w.addClass("PageListSortSaving");l(G);G.append(n.show());var C="";D.children(".PageListItem").each(function(){C+=a(this).data("pageId")+","});var y={id:z,parent_id:F,sort:C};y[a("#PageListContainer").attr("data-token-name")]=a("#PageListContainer").attr("data-token-value");var K="unknown";a.post(c.ajaxMoveURL,y,function(N){n.hide();B.fadeOut("fast",function(){a(this).fadeIn("fast");G.removeClass("PageListSortItem");w.removeClass("PageListSorting")});if(N&&N.error){alert(N.message)}if(!D.is("#PageListMoveFrom")){var M=H.prev(".PageListItem");var L=M.children(".PageListNumChildren");var P=L.text().length>0?parseInt(L.text())-1:0;if(P==0){P="";H.remove()}L.text(P);var O=D.prev(".PageListItem");L=O.children(".PageListNumChildren");P=L.text().length>0?parseInt(L.text())+1:1;L.text(P)}H.attr("id","");w.removeClass("PageListSortSaving")},"json");G.trigger("pageMoved");return true}function t(){var E=a(this);var D=E.parent("li").parent("ul.PageListActions").parent(".PageListItem");var C=D.data("pageId");var A=D.children(".PageListPage");var B=A.text();var z=A.attr("title");var y=w.children(".PageListSelectHeader");if(E.text()==c.selectUnselectLabel){C=0;B=""}if(C!=o.val()){o.val(C).change()}if(c.selectShowPageHeader){y.children(".PageListSelectName").text(B)}o.trigger("pageSelected",{id:C,url:z,title:B,a:A});y.find(".PageListSelectActionToggle").click();if(c.selectSelectHref=="#"){return false}return true}r()})}})(jQuery);