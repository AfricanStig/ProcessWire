function ProcessPageListInit(){if(ProcessWire.config.ProcessPageList){$("#"+ProcessWire.config.ProcessPageList.containerID).ProcessPageList(ProcessWire.config.ProcessPageList)}}$(document).ready(function(){ProcessPageListInit()});(function(a){a.fn.ProcessPageList=function(c){var d={mode:"",limit:35,rootPageID:0,showRootPage:true,selectedPageID:0,adminPageID:2,trashPageID:7,langID:0,selectAllowUnselect:false,selectShowPageHeader:true,selectShowPath:true,selectStartLabel:"Change",selectCancelLabel:"Cancel",selectSelectLabel:"Select",selectUnselectLabel:"Unselect",moreLabel:"More",trashLabel:"Trash",moveInstructionLabel:"Click and drag to move",selectSelectHref:"#",selectUnselectHref:"#",ajaxURL:ProcessWire.config.urls.admin+"page/list/",ajaxMoveURL:ProcessWire.config.urls.admin+"page/sort/",openPagination:0,openPageIDs:[],openPageData:{},speed:200,useHoverActions:false,hoverActionDelay:250,hoverActionFade:150,spinnerMarkup:"<i class='ui-priority-secondary fa fa-fw fa-spin fa-spinner'></i>",labelName:""};var b=[];var e=false;a.extend(d,c);return this.each(function(k){var u=a(this);var D;var t=a(d.spinnerMarkup).addClass("PageListLoading");var E=0;var g=0;function x(){D=a("<div class='PageListRoot'></div>");if(u.is(":input")){d.selectedPageID=u.val();if(!d.selectedPageID.length){d.selectedPageID=0}d.mode="select";u.before(D);B()}else{d.mode="actions";u.append(D);l(d.rootPageID>0?d.rootPageID:1,D,0,true)}if(d.useHoverActions&&!a("body").hasClass("touch-device")){D.addClass("PageListUseHoverActions");m()}}function m(){var H=null;var I=null;var G=null;function F(K){var L=K.find(".PageListActions");if(!L.is(":visible")||K.hasClass("PageListItemOpen")){K.addClass("PageListItemHover");L.css("display","inline").css("opacity",0).animate({opacity:1},d.hoverActionFade)}}function J(K){var L=K.find(".PageListActions");K.removeClass("PageListItemHover");if(L.is(":visible")){L.animate({opacity:0},d.hoverActionFade,function(){L.hide()})}}a(document).on("mouseover",".PageListItem",function(M){if(D.is(".PageListSorting")||D.is(".PageListSortSaving")){return}if(!a(this).children("a:first").is(":hover")){return}G=a(this);if(G.hasClass("PageListItemHover")){return}var K=a(this);if(H){clearTimeout(H)}var L=d.hoverActionDelay;H=setTimeout(function(){if(G.attr("class")==K.attr("class")){if(!G.children("a:first").is(":hover")){return}var N=a(".PageListItemHover");F(G);N.each(function(){J(a(this))})}},L)}).on("mouseout",".PageListItem",function(M){if(D.is(".PageListSorting")||D.is(".PageListSortSaving")){return}var K=a(this);if(K.hasClass("PageListItemOpen")){return}if(!K.hasClass("PageListItemHover")){return}var L=d.hoverActionDelay*0.7;I=setTimeout(function(){if(K.is(":hover")){return}if(K.attr("class")==G.attr("class")){return}J(K)},L)})}function B(){var F=a("<ul></ul>").addClass("PageListActions PageListSelectActions actions");var H=a("<p></p>").addClass("PageListSelectName");if(d.selectShowPageHeader){H.append(t)}var I=a("<a></a>").addClass("PageListSelectActionToggle").attr("href","#").text(d.selectStartLabel).click(function(){if(a(this).text()==d.selectStartLabel){l(d.rootPageID>0?d.rootPageID:1,D,0,true);a(this).text(d.selectCancelLabel)}else{D.children(".PageList").slideUp(d.speed,function(){a(this).remove()});a(this).text(d.selectStartLabel)}return false});F.append(a("<li></li>").append(I));D.append(a("<div></div>").addClass("PageListSelectHeader").append(H).append(F));if(d.selectShowPageHeader){var G=d.ajaxURL+"?id="+d.selectedPageID+"&render=JSON&start=0&limit=0&lang="+d.langID+"&mode="+d.mode;if(d.labelName.length){G+="&labelName="+d.labelName}a.getJSON(G,function(L){var J="";if(d.selectShowPath){J=L.page.path;if(J.substring(-1)=="/"){J=J.substring(0,J.length-1)}J=J.substring(0,J.lastIndexOf("/")+1);J='<span class="detail">'+J+"</span> "}var K=d.selectedPageID>0?J+L.page.label:"";D.children(".PageListSelectHeader").find(".PageListSelectName").html(K)})}}function w(){e=false}function y(F,G,M,Q){var O=9;var H=Math.ceil(Q/M);g=G>=M?Math.floor(G/M):0;if(g==0){E=0}else{if((g-O+1)>E){E=g-Math.floor(O/2)}else{if(E>0&&g==E){E=g-Math.ceil(O/2)}}}if(E>H-O){E=H-O}if(E<0){E=0}var N=a("<ul></ul>").addClass("PageListPagination").data("paginationInfo",{start:G,limit:M,total:Q});var P=function(Z){var T=a(this).parents("ul.PageListPagination");var Y=T.data("paginationInfo");if(!Y){return false}var aa=parseInt(a(this).attr("href"))*Y.limit;if(aa===NaN){aa=0}var U=y(F,aa,Y.limit,Y.total);var W=a(d.spinnerMarkup);var X=a("<li>&nbsp;</li>").append(W.hide());T.siblings(".PageList").remove();T.replaceWith(U);U.append(X);W.fadeIn("fast");var V=U.siblings().css("opacity",0.5);l(F,U.parent(),a(this).attr("href")*Y.limit,false,false,true,function(){W.fadeOut("fast",function(){X.remove()});U.parent(".PageList").prev(".PageListItem").data("start",aa);f()});return false};var L=null;var I=null;for(var S=E,J=0;S<H;S++,J++){var K=a("<a></a>").html(S+1).attr("href",S).addClass("ui-state-default");var R=a("<li></li>").addClass("PageListPagination"+J).append(K);if(S==g){R.addClass("PageListPaginationCurrent").find("a").removeClass("ui-state-default").addClass("ui-state-active")}N.append(R);if(!I){I=R.clone().removeClass("PageListPaginationCurrent ui-state-active");I.find("a").removeClass("ui-state-active").addClass("ui-state-default")}if(!L){L=I.clone().removeClass("ui-state-default").html("&hellip;")}if(J>=O&&S<H){$lastItem=I.clone();$lastItem.find("a").text(H).attr("href",H-1);N.append(L.clone()).append($lastItem);break}}if(E>0){$firstItem=I.clone();$firstItem.find("a").text("1").attr("href","0").click(P);N.prepend(L.clone()).prepend($firstItem)}if(g+1<H){$nextBtn=I.clone();$nextBtn.find("a").html("<i class='fa fa-angle-right'></i>").attr("href",g+1);N.append($nextBtn)}if(g>0){$prevBtn=I.clone();$prevBtn.find("a").attr("href",g-1).html("<i class='fa fa-angle-left'></i>");N.prepend($prevBtn)}N.find("a").click(P).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});return N}function l(G,J,H,L,O,I,N){if(O==undefined){O=true}if(I==undefined){I=false}var K=function(T){if(T&&T.error){alert(T.message);t.hide();e=false;return}var P=j(a(T.children));var S=T.start+T.limit;if(T.page.numChildren>S){var R=a("<a></a>").attr("href",S).data("pageId",G).text(d.moreLabel).click(A);P.append(a("<ul></ul>").addClass("PageListActions actions").append(a("<li></li>").addClass("PageListActionMore").append(R)))}if(O&&(T.page.numChildren>S||T.start>0)){P.prepend(y(G,T.start,T.limit,T.page.numChildren))}P.hide();if(L){var U;U=j(a(T.page));if(d.showRootPage){U.children(".PageListItem").addClass("PageListItemOpen")}else{U.children(".PageListItem").hide().parent(".PageList").addClass("PageListRootHidden")}U.append(P);J.append(U)}else{if(J.is(".PageList")){var Q=P.children(".PageListItem, .PageListActions");if(I){J.children(".PageListItem, .PageListActions").replaceWith(Q)}else{J.append(Q)}}else{J.after(P)}}if(t.parent().is(".PageListRoot")){t.hide()}else{t.fadeOut("fast")}if(I){P.show();w();if(N!=undefined){N()}}else{P.slideDown(d.speed,function(){w();if(N!=undefined){N()}})}P.prev(".PageListItem").data("start",T.start)};if(!I){J.append(t.fadeIn("fast"))}var M=G+"-"+H;if(typeof d.openPageData[M]!="undefined"){K(d.openPageData[M]);return}var F=d.ajaxURL+"?id="+G+"&render=JSON&start="+H+"&lang="+d.langID+"&open="+d.openPageIDs[0]+"&mode="+d.mode;if(d.labelName.length){F+="&labelName="+d.labelName}a.getJSON(F).done(function(Q,R,P){K(Q)}).fail(function(P,R,Q){K({error:1,message:!P.status?d.ajaxNetworkError:d.ajaxUnknownError})})}function j(F){var H=a("<div></div>").addClass("PageList");var G=H;F.each(function(J,I){G.append(i(I))});r(G);return H}function r(F){a("a.PageListPage",F).click(s);a(".PageListActionMove a",F).click(h);a(".PageListActionSelect a",F).click(z);a(".PageListTriggerOpen:not(.PageListID1) > a.PageListPage",F).click();a(".PageListActionExtras > a:not(.clickExtras)",F).addClass("clickExtras").on("click",o)}function i(L){var K=a("<div></div>").data("pageId",L.id).addClass("PageListItem").addClass("PageListTemplate_"+L.template);var J=a("<a></a>").attr("href","#").attr("title",L.path).html(L.label).addClass("PageListPage label");K.addClass("PageListID"+L.id);if(L.status==0){K.addClass("PageListStatusOff disabled")}if(L.status&2048){K.addClass("PageListStatusUnpublished secondary")}if(L.status&1024){K.addClass("PageListStatusHidden secondary")}if(L.status&512){K.addClass("PageListStatusTemp secondary")}if(L.status&16){K.addClass("PageListStatusSystem")}if(L.status&8){K.addClass("PageListStatusSystem")}if(L.status&4){K.addClass("PageListStatusLocked")}if(L.addClass&&L.addClass.length){K.addClass(L.addClass)}if(L.type&&L.type.length>0){if(L.type=="System"){K.addClass("PageListStatusSystem")}}a(d.openPageIDs).each(function(N,M){M=parseInt(M);if(L.id==M){K.addClass("PageListTriggerOpen")}});K.append(J);var H=a("<span>"+(L.numChildren?L.numChildren:"")+"</span>").addClass("PageListNumChildren detail");K.append(H);if(L.note&&L.note.length){K.append(a("<span>"+L.note+"</span>").addClass("PageListNote detail"))}var I=a("<ul></ul>").addClass("PageListActions actions");var G=d.rootPageID==L.id?[]:[{name:d.selectSelectLabel,url:d.selectSelectHref}];if(d.mode=="actions"){G=L.actions}else{if(d.selectAllowUnselect){if(L.id==u.val()){G=[{name:d.selectUnselectLabel,url:d.selectUnselectHref}]}}}var F=null;a(G).each(function(Q,O){var M;if(O.name==d.selectSelectLabel){M="Select"}else{if(O.name==d.selectUnselectLabel){M="Select"}else{M=O.cn}}var N=a("<a></a>").html(O.name).attr("href",O.url);if(typeof O.extras!="undefined"){N.data("extras",O.extras)}var P=a("<li></li>").addClass("PageListAction"+M).append(N);if(M=="Extras"){F=P}else{I.append(P)}});if(F){I.append(F);F.addClass("ui-priority-secondary")}K.append(I);return K}function o(M){var G=a(this);var I=G.data("extras");if(typeof I=="undefined"){return false}var P=G.closest(".PageListItem");var Q=G.closest(".PageListActions");var K=null;var N=G.children("i.fa");var O=Q.find("li.PageListActionExtra");N.toggleClass("fa-flip-horizontal");if(O.length){O.fadeOut(100,function(){O.remove()});return false}for(var H in I){var F=I[H];var L=a("<a />").addClass("PageListActionExtra PageListAction"+F.cn).attr("href",F.url).html(F.name);if(typeof F.ajax!="undefined"&&F.ajax==true){L.click(function(){P.find(".PageListActions").hide();var X=a(d.spinnerMarkup);var U=a(this).attr("href");var T=U.match(/[\?&]action=([-_a-zA-Z0-9]+)/)[1];var S=parseInt(U.match(/[\?&]id=([0-9]+)/)[1]);var W=a("#PageListContainer").attr("data-token-name");var V=a("#PageListContainer").attr("data-token-value");var R={action:T,id:S};R[W]=V;P.append(X);a.post(U+"&render=json",R,function(Y){if(Y.success){P.fadeOut("fast",function(){var ae=false;var af=Y.remove;var ad=Y.refreshChildren;var ab=false;if(typeof Y.child!="undefined"){ab=i(Y.child)}else{if(typeof Y.newChild!="undefined"){ab=i(Y.newChild);ae=true}}if(ab){var Z=a("<span />").addClass("notes").html(Y.message);Z.prepend("&nbsp;<i class='fa fa-check-square ui-priority-secondary'></i>&nbsp;");ab.append(Z);r(ab)}if(ae){X.fadeOut("normal",function(){X.remove()});ab.hide();P.after(ab);ab.slideDown()}else{if(ab){if(P.hasClass("PageListItemOpen")){ab.addClass("PageListItemOpen")}P.replaceWith(ab)}}P.fadeIn("fast",function(){setTimeout(function(){Z.fadeOut("normal",function(){if(af){var ag=ab.closest(".PageList").prev(".PageListItem").children(".PageListNumChildren");if(ag.length){var ah=parseInt(ag.text());if(ah>0){ag.text(ah-1)}}ab.next(".PageList").fadeOut("fast");ab.fadeOut("fast",function(){ab.remove()})}else{Z.remove()}})},1000)});if(ad){var aa=a(".PageListID"+ad);if(aa.length){aa.addClass("PageListForceReload");var ac=aa.children("a.PageListPage");if(aa.hasClass("PageListItemOpen")){ac.click();setTimeout(function(){ac.click()},250)}else{ac.click()}}}})}else{X.remove();alert(Y.message)}});return false})}else{}var J=a("<li />").addClass("PageListActionExtra PageListAction"+F.cn).append(L);L.hide();if(F.cn=="Trash"){P.addClass("trashable");K=J}else{Q.append(J)}}if(K){Q.append(K)}Q.find(".PageListActionExtra a").fadeIn(50,function(){a(this).css("display","inline-block")});return false}function s(G){var K=a(this);var J=K.parent(".PageListItem");var I=J.data("pageId");if(e&&!J.hasClass("PageListTriggerOpen")){return false}if(D.is(".PageListSorting")||D.is(".PageListSortSaving")){return false}if(J.hasClass("PageListItemOpen")){J.removeClass("PageListItemOpen").next(".PageList").slideUp(d.speed,function(){a(this).remove()})}else{J.addClass("PageListItemOpen");var F=parseInt(J.children(".PageListNumChildren").text());if(F>0||J.hasClass("PageListForceReload")){e=true;var H=C(I);l(I,J,H,false)}}if(d.mode!="select"){setTimeout(function(){f()},250)}return false}function C(J){var I=0;for(n=0;n<d.openPageIDs.length;n++){var G=d.openPageIDs[n];if(G.indexOf("-")==-1){continue}var H=d.openPageIDs[n].split("-");var F=parseInt(H[0]);if(F==J){I=parseInt(H[1]);break}}return I}function f(){b=[];a(".PageListItemOpen").each(function(){var G=a(this).data("pageId");var F=a(this).data("start");if(typeof F=="undefined"||F===null){F=0}else{var F=parseInt(F)}if(jQuery.inArray(G,b)==-1){b.push(G+"-"+F)}});a.cookie("pagelist_open",b)}function A(I){var K=a(this);var G=K.parent("li").parent("ul.PageListActions");var F=G.parent(".PageList");var J=K.data("pageId");var H=parseInt(K.attr("href"));l(J,F,H,false);G.remove();return false}function h(){if(e){return false}var L=a(this);if(a(".PageListItem:visible").length==1){L.css("text-decoration","line-through").addClass("ui-state-disabled");return false}var K=L.parent("li").parent("ul.PageListActions").parent(".PageListItem");if(K.hasClass("PageListItemOpen")){K.children(".PageListPage").click()}D.find(".PageListItemOpen").each(function(){var N=a(this).children(".PageListNumChildren").text();if(parseInt(N)>1&&a(this).next().find(".PageList:visible").size()==0){return}var M=a("<div></div>").addClass("PageListPlaceholder").addClass("PageList");M.append(a("<div></div>").addClass("PageListItem PageListPlaceholderItem").html("&nbsp;"));a(this).after(M)});var J={stop:p,helper:"PageListItemHelper",items:".PageListItem:not(.PageListItemOpen)",placeholder:"PageListSortPlaceholder",start:function(N,M){a(".PageListSortPlaceholder").css("width",M.item.children(".PageListPage").outerWidth()+"px")}};var G=D.children(".PageList").children(".PageList");var F=a("<a href='#'>"+d.selectCancelLabel+"</a>").click(function(){return q(K)});var I=K.children("ul.PageListActions");var H=a("<span class='PageListMoveNote detail'><i class='fa fa-fw fa-sort'></i> "+d.moveInstructionLabel+"<i class='fa fa-fw fa-angle-left'></i></span>");H.append(F);I.before(H);K.addClass("PageListSortItem");K.parent(".PageList").attr("id","PageListMoveFrom");D.addClass("PageListSorting");G.addClass("PageListSortingList").sortable(J);return false}function q(G){var F=D.find(".PageListSortingList");F.sortable("destroy").removeClass("PageListSortingList");G.removeClass("PageListSortItem").parent(".PageList").removeAttr("id");G.find(".PageListMoveNote").remove();D.find(".PageListPlaceholder").remove();D.removeClass("PageListSorting");return false}function v(I){var F=D.find(".PageListID"+d.trashPageID);if(!F.hasClass("PageListItemOpen")){D.removeClass("PageListSorting");F.children("a").click();D.addClass("PageListSorting")}var G=F.next(".PageList");if(G.length==0){G=a("<div class='PageList'></div>");F.after(G)}G.prepend(I);var H={item:I};p(null,H)}function p(L,Q){var N=Q.item;var I=N.children(".PageListPage");var G=parseInt(N.data("pageId"));var K=N.parent(".PageList");var O=a("#PageListMoveFrom");var P=K.prev().is(".PageListItem")?K.prev():K.prev().prev();var M=parseInt(P.data("pageId"));var H=N.prev(".PageListItem");if(H.is(".PageListItemOpen")){return false}if(K.is(".PageListPlaceholder")){K.removeClass("PageListPlaceholder").children(".PageListPlaceholderItem").remove()}D.addClass("PageListSortSaving");q(N);N.append(t.fadeIn("fast"));var J="";K.children(".PageListItem").each(function(){J+=a(this).data("pageId")+","});var F={id:G,parent_id:M,sort:J};F[a("#PageListContainer").attr("data-token-name")]=a("#PageListContainer").attr("data-token-value");var R="unknown";a.post(d.ajaxMoveURL,F,function(U){t.fadeOut("fast");I.fadeOut("fast",function(){a(this).fadeIn("fast");N.removeClass("PageListSortItem");D.removeClass("PageListSorting")});if(U&&U.error){alert(U.message)}if(!K.is("#PageListMoveFrom")){var T=O.prev(".PageListItem");var S=T.children(".PageListNumChildren");var W=S.text().length>0?parseInt(S.text())-1:0;if(W==0){W="";O.remove()}S.text(W);var V=K.prev(".PageListItem");S=V.children(".PageListNumChildren");W=S.text().length>0?parseInt(S.text())+1:1;S.text(W)}O.attr("id","");D.removeClass("PageListSortSaving")},"json");N.trigger("pageMoved");return true}function z(){var L=a(this);var K=L.parent("li").parent("ul.PageListActions").parent(".PageListItem");var J=K.data("pageId");var H=K.children(".PageListPage");var I=H.text();var G=H.attr("title");var F=D.children(".PageListSelectHeader");if(L.text()==d.selectUnselectLabel){J=0;I=""}if(J!=u.val()){u.val(J).change()}if(d.selectShowPageHeader){F.children(".PageListSelectName").text(I)}u.trigger("pageSelected",{id:J,url:G,title:I,a:H});F.find(".PageListSelectActionToggle").click();if(d.selectSelectHref=="#"){return false}return true}x()})}})(jQuery);