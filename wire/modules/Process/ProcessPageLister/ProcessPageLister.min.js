var ProcessLister={form:null,inInit:true,inTimeout:false,lastVal:"",spinner:null,numSubmits:0,results:null,filters:null,lister:null,initialized:false,resetTotal:false,clickAfterRefresh:"",refreshRowPageID:0,columnSort:function(){$(this).find("span").remove();var a=$(this).find("b").text();var b=$("#lister_sort").val();if(b==a){a="-"+a}if(a.length<1){a=b}$("#lister_sort").val(a);ProcessLister.submit()},init:function(){if(ProcessLister.initialized){return}ProcessLister.initialized=true;ProcessLister.spinner=$("<li class='title' id='ProcessListerSpinner'><i class='fa fa-lg fa-spin fa-spinner'></i></li>");$("#breadcrumbs ul.nav").append(ProcessLister.spinner);ProcessLister.filters=$("#ProcessListerFilters");ProcessLister.results=$("#ProcessListerResults");ProcessLister.lister=$("#ProcessLister");ProcessLister.filters.change(function(){ProcessLister.submit()});ProcessLister.results.on("click","th",ProcessLister.columnSort);$(document).on("click","a.actions_toggle",ProcessLister.pageClick);$(document).on("click",".actions a.ajax",ProcessLister.actionClickAjax);$("#actions_items_open").attr("disabled","disabled").parent("label").addClass("ui-state-disabled");$(document).on("click",".MarkupPagerNav a",function(){var a=$(this).attr("href");ProcessLister.submit(a);return false});$("#submit_refresh").click(function(){ProcessLister.resetTotal=true;ProcessLister.submit();$(this).fadeOut("normal",function(){$("#submit_refresh").removeClass("ui-state-active").fadeIn()});return false});$("#lister_columns").change(function(){ProcessLister.submit()});$("#ProcessListerActionsForm").find("script").remove();if(ProcessLister.lister.size()>0){ProcessLister.lister.WireTabs({items:$(".WireTab")})}$("#_ProcessListerRefreshTab").html("<i class='fa fa-refresh ui-priority-secondary'></i>").unbind("click").click(function(){ProcessLister.resetTotal=true;ProcessLister.submit();return false});$("#_ProcessListerResetTab").html("<i class='fa fa-rotate-left ui-priority-secondary'></i>").unbind("click").click(function(){window.location.href="./?reset=1";return false});ProcessLister.inInit=false;if(ProcessLister.numSubmits==0){ProcessLister.submit()}else{ProcessLister.spinner.fadeOut()}},submit:function(a){if(ProcessLister.inTimeout){clearTimeout(ProcessLister.inTimeout)}ProcessLister.inTimeout=setTimeout(function(){ProcessLister._submit(a)},250)},_submit:function(b){ProcessLister.numSubmits++;if(typeof b=="undefined"){var b="./"}ProcessLister.spinner.fadeIn("fast");var a={filters:ProcessLister.filters.val(),columns:$("#lister_columns").val(),sort:$("#lister_sort").val()};if(ProcessLister.resetTotal){a.reset_total=1;ProcessLister.resetTotal=false}if(ProcessLister.refreshRowPageID>0){a.row_page_id=ProcessLister.refreshRowPageID;ProcessLister.resetTotal=false}$.ajax({url:b,type:"POST",data:a,success:function(h){if(ProcessLister.refreshRowPageID){var i="#page"+ProcessLister.refreshRowPageID;var e=$(i).closest("tr");var g=$(h).find(i).closest("tr");var f=e.find(".actions_toggle").attr("data-message");if(e.length&&g.length){e.replaceWith(g);g.effect("highlight","fast");if(f){var c=$("<span class='row_message notes'>"+f+"</span>");g.find(".actions_toggle").addClass("row_message_on").closest("td").append(c);setTimeout(function(){c.fadeOut("normal",function(){g.find(".actions_toggle").removeClass("row_message_on").click()})},1000)}else{g.find(".actions_toggle").addClass("open")}}ProcessLister.refreshRowPageID=0}else{var d=$("#lister_sort").val();ProcessLister.results.html(h).find("th").each(function(){var m=$(this).find("b");var j=m.text();m.remove();$(this).find("span").remove();var k=$(this).find("i");var l=$(this).text();if(j==d){$(this).html("<u>"+l+"</u><span>&nbsp;&darr;</span><b>"+j+"</b>")}else{if(d=="-"+j){$(this).html("<u>"+l+"</u><span>&nbsp;&uarr;</span><b>"+j+"</b>")}else{$(this).html(l+"<b>"+j+"</b>")}}if(k.length>0){$(this).prepend(k)}}).end().effect("highlight","fast")}if(ProcessLister.clickAfterRefresh.length>0){if(ProcessLister.clickAfterRefresh.indexOf("#")<0&&ProcessLister.clickAfterRefresh.indexOf(".")<0){ProcessLister.clickAfterRefresh="#"+ProcessLister.clickAfterRefresh}$(ProcessLister.clickAfterRefresh).each(function(){var k=$(this);k.click();var j=k.closest("tr");j.fadeTo(100,0.1);setTimeout(function(){j.fadeTo(250,1)},250)});ProcessLister.clickAfterRefresh=""}ProcessLister.spinner.fadeOut();setTimeout(function(){ProcessLister.results.trigger("loaded");$("a.actions_toggle.open").click().removeClass("open")},250)},error:function(c){ProcessLister.results.html("<p>Error retrieving results: "+c+"</p>")}})},pageClick:function(){var b=$(this);if(b.hasClass("row_message_on")){return false}var e=b.closest("tr");var d=b.next(".actions");if(e.is(".open")){d.hide();e.removeClass("open");return false}else{d.css("display","inline-block");e.addClass("open")}var a=d.find(".PageExtra").hide();var c=d.find(".PageExtras");if($("body").hasClass("AdminThemeDefault")){c.addClass("ui-priority-secondary")}c.click(function(){var g=$(this);var f=d.find("a:not(.PageExtra):not(.PageExtras)");if(g.hasClass("extras-open")){a.hide();f.show();g.removeClass("extras-open")}else{f.hide();a.show();g.addClass("extras-open")}g.children("i.fa").toggleClass("fa-flip-horizontal");return false});return false},actionClickAjax:function(){var e=$(this);var c=e.closest("td").find(".actions_toggle");var a=parseInt(c.attr("id").replace("page",""));var d=e.closest(".actions");var b=e.attr("href");d.after("<i class='fa fa-spin fa-spinner ui-priority-secondary'></i>");d.hide();$.post(b,{ProcessPageLister:1},function(f){if(typeof f.page!="undefined"||f.action=="trash"){ProcessLister.clickAfterRefresh="#page"+f.page;ProcessLister.resetTotal=true}else{ProcessLister.refreshRowPageID=a}if(f.message){c.attr("data-message",f.message)}ProcessLister.submit()},"json");return false}};$(document).ready(function(){ProcessLister.init()});